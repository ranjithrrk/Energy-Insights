import React from 'react';
import { 
  BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer,
  LineChart, Line, LabelList
} from 'recharts';

const App = () => {
  // Data for Table 1: Price Distribution (Mapped for 100% Stacked View)
  const distributionData = [
    { 
      year: '2023', 
      '<2': 2, '2-4': 42, '4-6': 24, '6-8': 8, '8-12': 24 
    },
    { 
      year: '2024', 
      '<2': 6, '2-4': 55, '4-6': 19, '6-8': 3, '8-12': 17 
    },
    { 
      year: '2025', 
      '<2': 17, '2-4': 52, '4-6': 15, '6-8': 2, '8-12': 14 
    },
  ];

  // Data for Table 2: Hourly Average (Duck Curve)
  const hourlyRaw = [
    ["00:00", 6.34, 5.88, 4.55], ["01:00", 5.73, 5.09, 4.09], ["02:00", 5.05, 4.12, 3.68],
    ["03:00", 4.58, 3.72, 3.42], ["04:00", 4.38, 3.56, 3.27], ["05:00", 4.83, 3.52, 3.46],
    ["06:00", 5.68, 4.14, 4.17], ["07:00", 5.99, 4.78, 4.73], ["08:00", 5.47, 4.67, 3.79],
    ["09:00", 5.19, 4.13, 3.04], ["10:00", 4.83, 3.65, 2.19], ["11:00", 4.30, 3.16, 2.02],
    ["12:00", 3.96, 2.71, 1.92], ["13:00", 3.47, 2.34, 1.71], ["14:00", 3.67, 2.74, 1.97],
    ["15:00", 4.23, 3.14, 2.33], ["16:00", 4.88, 3.65, 2.74], ["17:00", 5.92, 4.87, 3.75],
    ["18:00", 6.81, 5.78, 5.55], ["19:00", 8.44, 7.19, 7.92], ["20:00", 7.41, 6.86, 6.75],
    ["21:00", 7.10, 6.72, 6.26], ["22:00", 6.87, 6.41, 6.10], ["23:00", 6.72, 6.32, 5.76],
    ["24:00", 6.56, 6.23, 5.29]
  ];

  const curveData = hourlyRaw.map(row => ({
    time: row[0],
    '2023': row[1],
    '2024': row[2],
    '2025': row[3]
  }));

  const colors = {
    cat1: "#166534", // Dark Green (<2)
    cat2: "#86efac", // Light Green (2-4)
    cat3: "#06b6d4", // Cyan (4-6)
    cat4: "#f59e0b", // Amber (6-8)
    cat5: "#ef4444", // Red (8-12)
    p23: "#94a3b8",
    p24: "#2563eb", // Using your accent-blue
    p25: "#0f172a", // Using your accent-navy
  };

  const renderCustomLabel = (props) => {
    const { x, y, width, value } = props;
    if (value < 5) return null; 
    const isLightBackground = width > 10 && (value === 52 || value === 55 || value === 42); 
    return (
      <text 
        x={x + width / 2} 
        y={y + 24} 
        fill={isLightBackground ? "#166534" : "#fff"} 
        textAnchor="middle" 
        fontSize={12} 
        fontWeight="bold"
      >
        {value}%
      </text>
    );
  };

  return (
    <div className="min-h-screen bg-[#fdfdfd] text-[#1a1a1a] font-sans">
      {/* Header - Styled to match your website */}
      <header className="fixed top-0 left-0 w-full z-50 flex justify-between items-center px-[5%] py-4 bg-white/90 backdrop-blur-md border-b border-gray-200">
        <a href="https://ranjithrrk.github.io/Energy-Insights/" className="text-[1.15rem] font-extrabold tracking-tight text-[#0f172a] uppercase no-underline">
          Ranjith’s Energy Digest
        </a>
        <div className="flex gap-3 items-center">
          <a href="https://ranjithrrk.github.io/Energy-Insights/" className="text-[13px] px-4 py-2 rounded-md font-semibold border border-gray-200 hover:bg-gray-50 no-underline text-gray-900 transition-colors">
            Home
          </a>
          <a href="https://www.linkedin.com/in/ranjith-kumar-r-768a1721/" target="_blank" className="hidden md:flex text-[13px] px-4 py-2 rounded-md font-semibold border border-[#0A66C2] text-[#0A66C2] hover:bg-[#f0f7ff] no-underline transition-colors">
            LinkedIn
          </a>
          <a href="https://chat.whatsapp.com/GoCN0Hiyhac2Za1ocmVhrQ" target="_blank" className="text-[13px] px-4 py-2 rounded-md font-semibold bg-[#16a34a] text-white hover:bg-[#15803d] no-underline transition-transform hover:-translate-y-px">
            Join Community
          </a>
        </div>
      </header>

      <main className="pt-28 pb-16 px-[5%] max-w-7xl mx-auto">
        <div className="mb-10 pb-5 border-b border-gray-100">
          <span className="inline-block text-[12px] font-bold text-[#2563eb] uppercase tracking-widest mb-3">Power Market Analysis</span>
          <h1 className="text-3xl md:text-4xl font-extrabold text-[#0f172a] tracking-tight leading-tight">IEX Power Analysis: Market Trends & Clearing Prices</h1>
        </div>

        {/* Stats Summary */}
        <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-10">
          <div className="bg-white p-6 rounded-xl border border-gray-100 shadow-sm">
            <h3 className="text-xs font-bold text-gray-500 uppercase tracking-widest">Midday Price Compression</h3>
            <p className="text-2xl font-black mt-2 text-[#16a34a]">1.71 ₹/kWh</p>
            <p className="text-xs text-gray-400 mt-1 italic">Average lowest price block (2025 YTD)</p>
          </div>
          <div className="bg-white p-6 rounded-xl border border-gray-100 shadow-sm">
            <h3 className="text-xs font-bold text-gray-500 uppercase tracking-widest">Evening Peak Premium</h3>
            <p className="text-2xl font-black mt-2 text-[#ef4444]">7.92 ₹/kWh</p>
            <p className="text-xs text-gray-400 mt-1 italic">Average peak recorded at 19:00 Hrs</p>
          </div>
        </div>

        {/* Visualization Grid */}
        <div className="grid grid-cols-1 lg:grid-cols-2 gap-10">
          {/* Price Distribution */}
          <div className="bg-white p-6 rounded-2xl border border-gray-100 shadow-sm">
            <div className="mb-8">
              <h2 className="text-lg font-bold text-[#0f172a]">Price Distribution Probability</h2>
              <p className="text-sm text-gray-500">Trading hours spent within specific price bands (%)</p>
            </div>
            <div className="h-[400px]">
              <ResponsiveContainer width="100%" height="100%">
                <BarChart data={distributionData} layout="vertical" margin={{ left: 10, right: 30 }} barSize={45}>
                  <CartesianGrid strokeDasharray="3 3" horizontal={false} stroke="#f8fafc" />
                  <XAxis type="number" hide />
                  <YAxis dataKey="year" type="category" axisLine={false} tickLine={false} fontWeight="800" fontSize={14} />
                  <Tooltip 
                    cursor={{fill: 'transparent'}}
                    contentStyle={{ borderRadius: '12px', border: 'none', boxShadow: '0 20px 25px -5px rgb(0 0 0 / 0.1)' }}
                  />
                  <Legend verticalAlign="top" align="center" iconType="rect" wrapperStyle={{paddingBottom: '20px'}} />
                  <Bar name="< 2 ₹" dataKey="<2" stackId="a" fill={colors.cat1}><LabelList dataKey="<2" content={renderCustomLabel} /></Bar>
                  <Bar name="2-4 ₹" dataKey="2-4" stackId="a" fill={colors.cat2}><LabelList dataKey="2-4" content={renderCustomLabel} /></Bar>
                  <Bar name="4-6 ₹" dataKey="4-6" stackId="a" fill={colors.cat3}><LabelList dataKey="4-6" content={renderCustomLabel} /></Bar>
                  <Bar name="6-8 ₹" dataKey="6-8" stackId="a" fill={colors.cat4}><LabelList dataKey="6-8" content={renderCustomLabel} /></Bar>
                  <Bar name="8-12 ₹" dataKey="8-12" stackId="a" fill={colors.cat5} radius={[0, 4, 4, 0]}><LabelList dataKey="8-12" content={renderCustomLabel} /></Bar>
                </BarChart>
              </ResponsiveContainer>
            </div>
          </div>

          {/* Duck Curve */}
          <div className="bg-white p-6 rounded-2xl border border-gray-100 shadow-sm">
            <div className="mb-8">
              <h2 className="text-lg font-bold text-[#0f172a]">The Solar "Duck" Curve</h2>
              <p className="text-sm text-gray-500">Average price profile shift (₹/kWh) over 24 hours</p>
            </div>
            <div className="h-[400px]">
              <ResponsiveContainer width="100%" height="100%">
                <LineChart data={curveData} margin={{ top: 10, right: 10, left: -10, bottom: 0 }}>
                  <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#f8fafc" />
                  <XAxis dataKey="time" axisLine={false} tickLine={false} interval={3} fontSize={11} fontWeight="600" />
                  <YAxis axisLine={false} tickLine={false} fontSize={11} unit="₹" />
                  <Tooltip contentStyle={{ borderRadius: '12px', border: 'none', boxShadow: '0 20px 25px -5px rgb(0 0 0 / 0.1)' }} />
                  <Legend verticalAlign="top" align="center" wrapperStyle={{paddingBottom: '20px'}} />
                  <Line name="2023" type="monotone" dataKey="2023" stroke={colors.p23} strokeWidth={2} dot={false} strokeDasharray="4 4" />
                  <Line name="2024" type="monotone" dataKey="2024" stroke={colors.p24} strokeWidth={2.5} dot={false} />
                  <Line name="2025 (YTD)" type="monotone" dataKey="2025" stroke={colors.p25} strokeWidth={4} dot={false} />
                </LineChart>
              </ResponsiveContainer>
            </div>
          </div>
        </div>

        <div className="mt-12 text-[#555555] text-lg leading-relaxed max-w-3xl">
          <p>This analysis highlights the structural shift in India's power markets. Increased solar penetration is driving midday prices toward the floor (below 2 ₹/kWh), while evening scarcity remains the primary price driver, often hitting the regulatory cap blocks in summer peak months.</p>
        </div>
      </main>

      <footer className="bg-[#0f172a] text-white py-16 px-[5%] text-center">
        <p className="opacity-70 text-sm">© 2024 Ranjith's Energy Digest. Independent Analysis & Data Intelligence.</p>
      </footer>
    </div>
  );
};

export default App;
